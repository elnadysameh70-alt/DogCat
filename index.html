<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>DOG & CAT</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body{font-family:Tahoma,Arial}
.card{background:#1e293b}
.locked{opacity:.4}
</style>
</head>

<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center">

<div id="notTelegram" class="hidden text-center p-6">
  <h2 class="text-xl font-bold">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ù…Ù† Ø¯Ø§Ø®Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… ÙÙ‚Ø·</h2>
</div>

<!-- PROFILE -->
<div id="profile" class="hidden w-full max-w-sm p-6 card rounded-xl text-center">
  <h1 class="text-2xl font-bold mb-2">DOG & CAT</h1>
  <p id="userInfo" class="mb-4"></p>

  <button onclick="openSubs()"
    class="w-full bg-green-600 py-3 rounded font-bold">
    Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
  </button>
</div>

<!-- SUBSCRIPTIONS -->
<div id="subs" class="hidden w-full max-w-sm p-4 space-y-3">

  <h2 class="text-xl font-bold text-center">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h2>

  <div id="plans"></div>

  <button onclick="backProfile()"
    class="w-full bg-gray-600 py-2 rounded font-bold">
    Ø±Ø¬ÙˆØ¹
  </button>
</div>

<script>
const tg = window.Telegram.WebApp;

const prices = [200,500,1000,5000,10000,50000];

if(!tg.initDataUnsafe.user){
  notTelegram.classList.remove("hidden");
}else{
  tg.ready(); tg.expand();
  const u = tg.initDataUnsafe.user;
  userInfo.innerText = "ğŸ‘¤ "+u.first_name+"\nğŸ†” "+u.id;
  profile.classList.remove("hidden");

  if(!localStorage.getItem("level")){
    localStorage.setItem("level", "1");
    localStorage.setItem("status", "none"); // none | pending | active
  }
}

function openSubs(){
  profile.classList.add("hidden");
  subs.classList.remove("hidden");
  renderPlans();
}

function backProfile(){
  subs.classList.add("hidden");
  profile.classList.remove("hidden");
}

function renderPlans(){
  const level = parseInt(localStorage.getItem("level"));
  const status = localStorage.getItem("status");
  plans.innerHTML = "";

  prices.forEach((price,i)=>{
    const planLevel = i+1;
    let locked = planLevel !== level;
    let btnText = "Ø§Ø´ØªØ±Ùƒ";
    let btnAction = `requestSub(${planLevel})`;
    let extra = "";

    if(planLevel < level){
      btnText = "ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡";
      btnAction = "";
    }

    if(planLevel === level && status === "pending"){
      btnText = "ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù†";
      btnAction = "";
      extra = "â³";
    }

    plans.innerHTML += `
      <div class="card p-4 rounded-xl ${locked?'locked':''}">
        <p class="font-bold">ğŸ± ${price} Ø¬Ù†ÙŠÙ‡</p>
        <p class="text-sm">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${planLevel} ${extra}</p>
        <button
          ${locked||btnAction==""?'disabled':''}
          onclick="${btnAction}"
          class="w-full mt-2 bg-blue-600 py-2 rounded font-bold">
          ${btnText}
        </button>
      </div>
    `;
  });
}

function requestSub(level){
  localStorage.setItem("status","pending");
  alert(
    "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ "+level+
    "\nØ¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù†"
  );
  renderPlans();
}

/* Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø© (Ù…Ø¤Ù‚ØªÙ‹Ø§) */
setTimeout(()=>{
  if(localStorage.getItem("status")==="pending"){
    localStorage.setItem("status","active");
  }else if(localStorage.getItem("status")==="active"){
    let lvl = parseInt(localStorage.getItem("level"));
    localStorage.setItem("level", lvl+1);
    localStorage.setItem("status","none");
  }
}, 20000); // 20 Ø«Ø§Ù†ÙŠØ© ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø·
</script>

</body>
  </html>
